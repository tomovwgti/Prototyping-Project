<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html>
<head>
    <title>frequency decoder - accessible, unobtrusive slider demo</title>
    <meta http-equiv="Content-Type"         content="text/html; charset=iso-8859-1" />
    <meta name="author"                     content="frequency decoder" />
    <meta name="description"                content="An unobtrusive javascript that turns any text input or selectlist into a keyboard-accessible slider control" />
    <meta http-equiv="imagetoolbar"         content="no" />

    <link rel="stylesheet" type="text/css" media="screen, projection" href="css/slider.css" />
    <link rel="stylesheet" type="text/css" href="css/led.css">

    <script type="text/javascript" src="js/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="js/slider.js"></script>

<script type="text/javascript">
//<![CDATA[

// Preloading the images used for the slider handle
var imgList = ["slider-disabled.png", "slider-disabled-1.png", "slider.png", "slider-1.png"];
var preloadImg = []
for(var i = 0, imgSrc; imgSrc = imgList[i]; i++) {
    preloadImg[i] = new Image();
    preloadImg[i].src = "image/" + imgSrc;
};

// WebSocket
var ws = new WebSocket('ws://192.168.110.195:8001/');

// Create the div used to show the dynamically generated color
function createColorBox() {
    var dl = document.getElementsByTagName('dl')[0];
    var box  = document.createElement('div');
    box.setAttribute('id','colorBox');
    var res  = document.createElement('div');
    res.setAttribute('id','hexValue');

    dl.parentNode.insertBefore(res, dl.nextSibling);
    dl.parentNode.insertBefore(box, res);
    updateColor();

    // Clean up for poor old IE
    res = box = null;
}

// Convert and rgb value to hex
function toHex(N) {
    if (N==null) return "00";
    N=parseInt(N);
    if (N==0 || isNaN(N)) return "00";
    N=Math.max(0,N); N=Math.min(N,255);
    N=Math.round(N);
    return "0123456789ABCDEF".charAt((N-N%16)/16) + "0123456789ABCDEF".charAt(N%16);
}

// Message from Server
ws.onmessage = function (event) {
    var receive_message = event.data;
    console.log('receive message <-- ' + receive_message);
    $('body').append('<li>' + receive_message + '</li>');
    // goto Google Maps
    var schema = $.url(receive_message).attr('protocol');
    if (-1 != schema.indexOf('geo')) {
        var map = 'http://maps.google.co.jp/?ie=UTF8&ll=' + $.url(receive_message).attr('host') + '&z=13';
        document.location = map;
    }
}

function updateColor() {
    var r = parseInt($('#slider-r').val(), 10) || 0;
    var g = parseInt($('#slider-g').val(), 10) || 0;
    var b = parseInt($('#slider-b').val(), 10) || 0;

    $('#colorBox').css("background-color","rgb("+r+ ","+g+","+b+")");
    $('#hexValue').html('#' + toHex(r) + toHex(g) + toHex(b));

    var send_message = 'command://light?r=' + r + '&g=' + g + '&b=' + b;
    console.log(send_message);
    ws.send(send_message);
}

$(function(){
    var led_state = false;
    $('#chime').click(function() {
        var send_message = 'command://chime';
        console.log(send_message);
        ws.send(send_message);
    });

    $('#led').click(function() {
        led_state = !led_state;
        var send_message = 'command://led?state=' + led_state;
        console.log(send_message);
        ws.send(send_message);
    });
});

// Demo specific onload events (uses the addEvent method bundled with the slider)
fdSliderController.addEvent(window, 'load', createColorBox);

//]]>
</script>
</head>
<body>
<div id="article-wrapper">
  <form action="" method="post">
    <fieldset>
      <dl>
        <dt>
            <label for="slider-r">Red:</label>
        </dt>
        <dd>
            <input name="slider1" id="slider-r" type="text" title="Range: 0 - 255" class="fd_range_0_255 fd_classname_extraclass fd_callback_updateColor" value="128" />
        </dd>
        <dt>
            <label for="slider-g">Green:</label>
        </dt>
        <dd>
            <input name="slider2" id="slider-g" type="text" title="Range: 0 - 255" class="fd_range_0_255 fd_classname_extraclass fd_callback_updateColor" value="128" />
        </dd>
        <dt>
            <label for="slider-b">Blue:</label>
        </dt>
        <dd>
            <input name="slider3" id="slider-b" type="text" title="Range: 0 - 255" class="fd_range_0_255 fd_classname_extraclass fd_callback_updateColor" value="128" />
        </dd>
      </dl>
    </fieldset>
  </form>
</div>
<div>
    <input type="button" id="chime" value="Chime" style="width:100px">
    <input type="button" id="led" value="LED" style="width:100px">
</div>
</body>
</html>
